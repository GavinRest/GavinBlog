import{_ as s,p as l,q as p,a1 as i}from"./framework-5866ffd3.js";const t="/assets/hsrp_hello-733aead8.png",e="/assets/hsrp_hello_detail-61eee427.png",a="/assets/hsrp_v2-8df206ba.png",o="/assets/hsrp_topology-b6789ecc.png",r="/assets/hsrp_resign-19262984.png",n={},c=i('<h1 id="hsrp" tabindex="-1"><a class="header-anchor" href="#hsrp" aria-hidden="true">#</a> HSRP</h1><p>HSRP 热备份路由器协议（HSRP：Hot Standby Router Protocol），是 cisco 平台一种特有的技术，是 cisco 私有协议。 封装在UDP协议。</p><h3 id="hsrp-简介" tabindex="-1"><a class="header-anchor" href="#hsrp-简介" aria-hidden="true">#</a> HSRP 简介</h3><p>该协议中含有多台路由器，对应一个 HSRP 组。该组中只有一个路由器承担转发用户流量的职责，这就是活动路由器（active）。当活动路由器失效后，备份路由器（standby）将承担该职责，成为新的活动路由器。这就是热备份的原理。</p><p>HSRP报文类型</p><ul><li><p>Hello: hello 消息通知其他路由器发送路由器的HSRP优先级和状态信息，hello 路由器默认为每3秒钟发送一个hello消息</p></li><li><p>Coup: 当一个备用路由器变为一个主动路由器时发送一个 coup 消息</p></li><li><p>Resign: 当主动路由器要宕机或者当有优先级更高的路由器发送hello消息时，主动路由器发送一个resign消息。在任一时刻，配置了HSRP协议的路由器都将处于以下六种状态之一：</p></li><li><p>Initial: HSRP启动时的状态，HSRP还没有运行，一般是在改变配置或端口刚刚启动时进入该状态。</p></li><li><p>Learn: 学习状态，不知道虚拟IP，未看到活跃路由器发hello。等待活跃路由器发hello。</p></li><li><p>Listen: 路由器已经得到了虚拟IP地址，但是它既不是活动路由器也不是等待路由器。它一直监听从活动路由器和等待路由器发来的HELLO报文。</p></li><li><p>Speak: 在该状态下，路由器定期发送HELLO报文，并且积极参加活动路由器或等待路由器的竞选。</p></li><li><p>Standby: 当主动路由器失效时路由器准备接管包传输功能。</p></li><li><p>Active: 路由器执行包传输功能。</p></li></ul><p>HSRP报文分析</p><ol><li>HSRP的 active 和 standby 每3秒发送一个hello报文。如图 hello 包是由 active 和 standby 发出的，每隔3秒向组播地址 224.0.0.2 发送一个包、源端口和目标端口都是1985（version 1）。</li></ol><p><img src="'+t+'" alt="hsrp_hello"></p><ol start="2"><li>如图可以看到 HSRP 版本0包发送到组播地址224.0.0.2端口号为udp 1985状态是active，默认HSRP认证为“cisco”，虚拟IP地址为10.10.10.1。</li></ol><p><img src="'+e+'" alt="hsrp_hello_detail"></p><ol start="3"><li>hsrp version 2 包分析：很明显的看到就是组播地址不同，version2 组播地址是224.0.0.102。</li></ol><p><img src="'+a+'" alt="hsrp_v2"></p><ol start="4"><li><p>根据报文推断：首先在hsrp组里面要选出一个active路由器，这个路由器选举规则还是看优先级大小，和ip地址的大小越大越有限，当然hsrp默认不开启抢占也就是说你们同时在speak状态在可以竞选，如果竞选完毕active选举出来了，那么后来的路由器优先级高也没资格抢active，只能去选standby路由器。</p></li><li><p>拓扑解说：在如下图R5被选举成为了active，R4由于IP地址大竞选成了standby。下面我们抓包分析。</p></li></ol><p><img src="'+o+'" alt="hsrp_topology"></p><ol start="6"><li>HSRP其它报文分析：我们手动把R5的F0/1口down掉。这个时候我们看到R5在“临死”的时候留下了一句话 resign消息。这个时候R5相当于告诉大家我要辞职了，standby要接替我的位置了。这个时候我们看到了第2个包是R2和R3的状态变成了speak，去竞选standby了，那么R4顺利的成为了active（coup），R3赢得了standby。可以看到后来的hello包都是由R3和R4发出的。</li></ol><p><img src="'+r+'" alt="hsrp_resign"></p><p>备注：我们在敲命令standby ip 10.10.10.1 例如在R2上敲了，在R3 R4 R5路由器上可以只敲standby ip 这样会学习过来R2上的 virtual ip。</p>',18),h=[c];function _(d,R){return l(),p("div",null,h)}const H=s(n,[["render",_],["__file","hsrp.html.vue"]]);export{H as default};
